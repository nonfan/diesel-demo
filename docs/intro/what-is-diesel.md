# Diesel 是什么？

**Diesel** 是一个为 Rust 编程语言构建的高性能、安全、类型安全的 ORM（Object-Relational Mapping）框架。它通过 Rust
的类型系统和编译期检查机制，提供了一种**防止运行时 SQL 错误**的方式，从而大幅提升了数据库操作的可靠性。

在传统 ORM 中，数据库查询往往是以字符串的形式存在，只有在运行时才知道是否正确。而 Diesel
的查询则是完全编译期检查的，任何字段拼写错误、类型不匹配、表结构错误等，都会在**编译阶段被发现**。

## 核心特点

- ✅ **类型安全**：每个查询都经过 Rust 编译器类型检查，防止运行时 SQL 错误。

- ⚡ **高性能**：底层是直接使用 Rust 语言调用数据库驱动，性能接近手写 SQL。

- 🧱 **结构清晰**：通过 schema.rs 和宏定义，将数据库表结构直接映射为 Rust 类型。

- 🔄 **可组合的查询 DSL**：查询表达式支持链式组合，代码优雅、强可读性。

- 📦 **支持主流数据库**：支持 PostgreSQL、MySQL、SQLite。

## Diesel 的设计理念

> “让数据库操作像写 Rust 一样安全、清晰、可维护。”

Diesel 不仅仅是一个 ORM，更是一个**为系统级 Rust 项目而优化的数据库层解决方案**。它适合用于 Web
后端服务、命令行工具、嵌入式系统等对性能和安全有较高要求的场景。

## Diesel 的优势与特点

Diesel 在 Rust 生态中具有独特的地位，凭借其强大的类型系统集成、编译期安全保障以及接近底层性能的查询执行方式，使其在众多 ORM
框架中脱颖而出。

### 🚀 编译期保障，远离运行时 SQL 错误

Diesel 最大的特点在于**编译期查询检查**，这在主流 ORM（如 Prisma、TypeORM、SeaORM）中是极为罕见的。传统 ORM 通常在运行时才抛出
SQL 错误，而 Diesel 可以在编译阶段就报错：

| 特性          | Diesel ✅ | Prisma / SeaORM ❌ |
|-------------|:--------:|------------------:|
| 编译期检查查询合法性  |   ✅ 支持   |          ❌ 仅运行时报错 |
| 编译期校验字段名/类型 |   ✅ 支持   |         ❌ 不校验或弱校验 |
| 查询链式组合（DSL） |   ✅ 支持   |          ✅ 但语义类型弱 |

### 📦 零运行时依赖，高性能执行

Diesel 使用 Rust 原生代码生成方式，执行效率极高。相比那些运行时解释查询语句的 ORM，Diesel 更加贴近底层执行，性能表现几乎与手写
SQL 相当。

- 不依赖动态语言运行时（如 JS/TS 的 Prisma、Node ORM）。

- 查询语句通过宏展开放入编译单元，执行速度快、内存占用少。

### 🛡️ 类型系统加持，避免数据类型不匹配

所有表结构、字段、关系等在 Rust 类型系统中体现，通过编译器静态检查，**不可能出现「字符串拼错」、「字段名错误」、「字段类型不一致」的问题
**。

### 🧬 支持复杂关联关系

通过 `belongs_to`、`has_many` 等宏标注，Diesel 可以处理一对多、多对多等复杂关系，并通过 `belonging_to()` 与 `grouped_by()`
实现嵌套查询与聚合。

相比之下，SeaORM 等虽然也支持关联，但其类型约束相对宽松，某些错误可能在运行时才暴露。

### 🌐 多数据库支持 & 无缝切换

Diesel 原生支持三大主流数据库：

- [PostgreSQL](https://github.com/nonfan/diesel-demo/tree/db/postgres-crud)（功能最全面）

- [MySQL](https://github.com/nonfan/diesel-demo/tree/db/mysql-crud)（高兼容性）

- [SQLite](https://github.com/nonfan/diesel-demo/tree/db/sqlite-crud)（轻量便捷，适合开发和测试）

且其代码结构清晰、跨数据库切换成本较低。

